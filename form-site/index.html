<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Doctor - Formulaire Patient</title>
    <link rel="icon" type="image/svg+xml" href="img/favicon.svg">
    <link rel="stylesheet" href="css/form.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700&family=Open+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <style>
        .captcha-container {
            display: flex;
            justify-content: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <!-- Header -->
        <header class="form-header">
            <div class="logo">
                <a href="https://www.traveldoctor.ch" class="logo-link">
                    <img src="img/logo.svg" alt="Travel Doctor" class="logo-img">
                </a>
            </div>
            <div class="language-selector">
                <select id="language-select" onchange="setLanguage(this.value)">
                    <option value="fr">Fran&ccedil;ais</option>
                    <option value="en">English</option>
                    <option value="it">Italiano</option>
                    <option value="es">Espa&ntilde;ol</option>
                </select>
            </div>
        </header>

        <!-- Progress Steps -->
        <div class="progress-container">
            <div class="progress-steps">
                <div class="step active" data-step="1" onclick="goToStep(1)">
                    <div class="step-number">1</div>
                    <div class="step-label" data-translate="steps.identity">Identit&eacute;</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="2" onclick="goToStep(2)">
                    <div class="step-number">2</div>
                    <div class="step-label" data-translate="steps.travel">Voyage</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="3" onclick="goToStep(3)">
                    <div class="step-number">3</div>
                    <div class="step-label" data-translate="steps.health">Sant&eacute;</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="4" onclick="goToStep(4)">
                    <div class="step-number">4</div>
                    <div class="step-label" data-translate="steps.vaccination">Vaccinations</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="5" onclick="goToStep(5)">
                    <div class="step-number">5</div>
                    <div class="step-label" data-translate="steps.referral">Recommandation</div>
                </div>
                <div class="step-line"></div>
                <div class="step" data-step="6" onclick="goToStep(6)">
                    <div class="step-number">6</div>
                    <div class="step-label" data-translate="steps.summary">R&eacute;capitulatif</div>
                </div>
            </div>
        </div>

        <!-- Form -->
        <form id="patient-form" novalidate>
            <!-- Step 1: Identity -->
            <div class="form-step active" data-step="1">
                <h2 class="step-title" data-translate="steps.identity">Identit&eacute;</h2>
                <p class="step-subtitle" data-translate="identity.subtitle">Une seule personne par formulaire</p>

                <div class="form-group">
                    <label for="full_name" data-translate="identity.full_name">Pr&eacute;nom et Nom *</label>
                    <input type="text" id="full_name" name="full_name" required maxlength="100"
                           data-placeholder="identity.full_name_placeholder">
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label for="birthdate" data-translate="identity.birthdate">Date de naissance *</label>
                    <input type="date" id="birthdate" name="birthdate" required>
                    <span class="field-hint" data-translate="hints.birthdate_max">Date dans le pass&eacute;</span>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label for="email" data-translate="identity.email">Email *</label>
                    <input type="email" id="email" name="email" required maxlength="254"
                           data-placeholder="identity.email_placeholder">
                    <span class="hint" data-translate="identity.email_hint">Email pour recevoir la confirmation</span>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label for="phone" data-translate="identity.phone">T&eacute;l&eacute;phone</label>
                    <input type="tel" id="phone" name="phone" maxlength="20"
                           data-placeholder="identity.phone_placeholder">
                    <span class="optional-badge" data-translate="buttons.optional">Facultatif</span>
                </div>

                <div class="form-row">
                    <div class="form-group flex-2">
                        <label for="appointment_datetime" data-translate="identity.appointment_datetime">
                            Date et heure du rendez-vous *
                        </label>
                        <input type="datetime-local" id="appointment_datetime" name="appointment_datetime" step="300" required>
                        <span class="hint" data-translate="identity.appointment_datetime_hint">Date et heure de votre consultation</span>
                        <span class="error-message"></span>
                    </div>
                    <div class="form-group flex-1">
                        <label for="appointment_location" data-translate="identity.appointment_location">
                            Lieu *
                        </label>
                        <select id="appointment_location" name="appointment_location" required>
                            <option value="" data-translate="identity.appointment_location_placeholder">Choisir...</option>
                            <option value="lausanne">Lausanne</option>
                            <option value="la-tour-de-treme">La Tour-de-Tr&ecirc;me</option>
                            <option value="telemedicine" data-translate="identity.appointment_telemedicine">T&eacute;l&eacute;m&eacute;decine</option>
                        </select>
                        <span class="error-message"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="avs" data-translate="identity.avs">Num&eacute;ro AVS</label>
                    <input type="text" id="avs" name="avs" maxlength="16"
                           pattern="^756\.\d{4}\.\d{4}\.\d{2}$"
                           data-placeholder="identity.avs_placeholder">
                    <span class="hint" data-translate="identity.avs_hint">Permet de retrouver votre dossier facilement</span>
                    <span class="optional-badge" data-translate="buttons.optional">Facultatif</span>
                    <span class="error-message"></span>
                </div>

                <div class="form-row">
                    <div class="form-group flex-2">
                        <label for="street" data-translate="identity.street">Rue</label>
                        <input type="text" id="street" name="street" maxlength="200">
                        <span class="optional-badge" data-translate="buttons.optional">Facultatif</span>
                    </div>
                    <div class="form-group flex-1">
                        <label for="postal_code" data-translate="identity.postal_code">Code postal</label>
                        <input type="text" id="postal_code" name="postal_code" maxlength="10">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label for="city" data-translate="identity.city">Ville</label>
                        <input type="text" id="city" name="city" maxlength="100">
                    </div>
                    <div class="form-group flex-1">
                        <label for="residence_country" data-translate="identity.country">Pays de r&eacute;sidence</label>
                        <div class="country-autocomplete">
                            <input type="text" id="residence_country_search" maxlength="100"
                                   data-placeholder="identity.country_placeholder"
                                   autocomplete="off">
                            <input type="hidden" id="residence_country" name="residence_country">
                            <div class="autocomplete-dropdown"></div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label data-translate="identity.gender">Sexe biologique *</label>
                    <span class="hint" data-translate="identity.gender_hint">Information n&eacute;cessaire pour adapter les recommandations m&eacute;dicales</span>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="gender" value="femme" required>
                            <span data-translate="identity.gender_female">Femme</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="gender" value="homme">
                            <span data-translate="identity.gender_male">Homme</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>
            </div>

            <!-- Step 2: Travel -->
            <div class="form-step" data-step="2">
                <h2 class="step-title" data-translate="steps.travel">Voyage</h2>

                <div class="form-group flexible-dates-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="flexible-dates" name="flexible_dates" onchange="toggleFlexibleDates()">
                        <span data-translate="travel.flexible_dates">Je ne connais pas encore les dates exactes par pays</span>
                    </label>
                </div>

                <div class="form-group trip-dates-group" style="display:none">
                    <label data-translate="travel.trip_dates">Dates du voyage *</label>
                    <div class="trip-dates-row">
                        <div class="date-field-wrapper">
                            <label for="trip-departure" data-translate="travel.trip_departure">D&eacute;part du voyage</label>
                            <input type="date" id="trip-departure" name="trip_departure">
                        </div>
                        <div class="date-field-wrapper">
                            <label for="trip-return" data-translate="travel.trip_return">Retour du voyage</label>
                            <input type="date" id="trip-return" name="trip_return">
                        </div>
                    </div>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="travel.destinations">Pays de destination *</label>
                    <div id="destinations-container">
                        <div class="destination-header" id="destination-header">
                            <span data-translate="travel.country">Pays</span>
                            <span class="dest-header-dates" data-translate="travel.departure">D&eacute;part</span>
                            <span class="dest-header-dates" data-translate="travel.return">Retour</span>
                            <span class="dest-header-duration" data-translate="travel.estimated_duration">Dur&eacute;e estim&eacute;e</span>
                            <span></span>
                        </div>
                        <div class="destination-row" data-index="0">
                            <div class="destination-fields">
                                <div class="country-autocomplete destination-country-wrapper">
                                    <input type="text" class="destination-country-search"
                                           data-placeholder="travel.country_placeholder"
                                           autocomplete="off">
                                    <input type="hidden" class="destination-country" name="destinations[0][country]">
                                    <div class="autocomplete-dropdown"></div>
                                </div>
                                <div class="date-field-wrapper destination-dates">
                                    <label class="mobile-label" data-translate="travel.departure">D&eacute;part</label>
                                    <input type="date" class="destination-departure" name="destinations[0][departure]"
                                           aria-label="Date de d&eacute;part">
                                </div>
                                <div class="date-field-wrapper destination-dates">
                                    <label class="mobile-label" data-translate="travel.return">Retour</label>
                                    <input type="date" class="destination-return" name="destinations[0][return]"
                                           aria-label="Date de retour">
                                </div>
                                <div class="destination-duration">
                                    <label class="mobile-label" data-translate="travel.estimated_duration">Dur&eacute;e estim&eacute;e</label>
                                    <select class="destination-estimated-duration" name="destinations[0][estimated_duration]">
                                        <option value="">--</option>
                                        <option value="few_days" data-translate="travel.duration_options.few_days">Quelques jours</option>
                                        <option value="less_1_week" data-translate="travel.duration_options.less_1_week">&lt; 1 semaine</option>
                                        <option value="1_2_weeks" data-translate="travel.duration_options.1_2_weeks">1 &agrave; 2 semaines</option>
                                        <option value="2_3_weeks" data-translate="travel.duration_options.2_3_weeks">2 &agrave; 3 semaines</option>
                                        <option value="1_month" data-translate="travel.duration_options.1_month">~1 mois</option>
                                        <option value="1_2_months" data-translate="travel.duration_options.1_2_months">1 &agrave; 2 mois</option>
                                        <option value="2_3_months" data-translate="travel.duration_options.2_3_months">2 &agrave; 3 mois</option>
                                        <option value="3_6_months" data-translate="travel.duration_options.3_6_months">3 &agrave; 6 mois</option>
                                        <option value="over_6_months" data-translate="travel.duration_options.over_6_months">&gt; 6 mois</option>
                                    </select>
                                </div>
                                <button type="button" class="btn-remove-destination" onclick="removeDestination(this)" style="display:none;">
                                    &times;
                                </button>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-add" onclick="addDestination()">
                        <span>+</span> <span data-translate="travel.add_country">Ajouter un pays</span>
                    </button>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="travel.reason">Quel est le but de votre voyage ? *</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="tourisme_organise">
                            <span data-translate="travel.reason_organized">Tourisme en voyage organis&eacute;</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="tourisme_independant">
                            <span data-translate="travel.reason_independent">Tourisme ind&eacute;pendant</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="affaires">
                            <span data-translate="travel.reason_business">Voyage d'affaires</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="aventure">
                            <span data-translate="travel.reason_adventure">Aventure</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="visite_famille">
                            <span data-translate="travel.reason_family">Visite amis/famille</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="humanitaire">
                            <span data-translate="travel.reason_humanitarian">Mission humanitaire</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="pelerinage">
                            <span data-translate="travel.reason_pilgrimage">P&egrave;lerinage</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="expatriation">
                            <span data-translate="travel.reason_expatriation">Expatriation</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="travel_reason" value="autre" onchange="toggleOtherField(this, 'travel_reason_other')">
                            <span data-translate="travel.reason_other">Autre</span>
                        </label>
                    </div>
                    <input type="text" id="travel_reason_other" name="travel_reason_other" class="other-field hidden" maxlength="200"
                           data-placeholder="travel.specify">
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="travel.accommodation">Type d'h&eacute;bergement *</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="accommodation" value="pas_decide">
                            <span data-translate="travel.accommodation_undecided">Pas encore d&eacute;cid&eacute;</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="accommodation" value="habitant">
                            <span data-translate="travel.accommodation_local">Chez l'habitant</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="accommodation" value="hotel">
                            <span data-translate="travel.accommodation_hotel">H&ocirc;tel</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="accommodation" value="autre" onchange="toggleOtherField(this, 'accommodation_other')">
                            <span data-translate="travel.accommodation_other">Autre</span>
                        </label>
                    </div>
                    <input type="text" id="accommodation_other" name="accommodation_other" class="other-field hidden" maxlength="200"
                           data-placeholder="travel.specify">
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="travel.activities">Pr&eacute;voyez-vous des activit&eacute;s particuli&egrave;res ? *</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="alpinisme" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_mountaineering">Alpinisme</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="randonnee" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_hiking">Randonn&eacute;e</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="plongee" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_diving">Plong&eacute;e</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="rafting" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_rafting">Rafting</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="velo" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_cycling">V&eacute;lo</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="snorkeling" onchange="uncheckNoneActivity()">
                            <span data-translate="travel.activity_snorkeling">Snorkeling</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="autre" onchange="toggleOtherField(this, 'activities_other'); uncheckNoneActivity()">
                            <span data-translate="travel.activity_other">Autre</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="activities" value="aucune" onchange="toggleNoneActivity(this)">
                            <span data-translate="travel.activity_none">Aucune de ces activit&eacute;s</span>
                        </label>
                    </div>
                    <input type="text" id="activities_other" name="activities_other" class="other-field hidden" maxlength="200"
                           data-placeholder="travel.specify">
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="travel.rural">Pr&eacute;voyez-vous un s&eacute;jour en zone rurale ou isol&eacute;e ? *</label>
                    <span class="hint" data-translate="travel.rural_hint">&Eacute;loign&eacute; d'un h&ocirc;pital ou d'une pharmacie</span>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="rural_stay" value="oui" required>
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="rural_stay" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>
            </div>

            <!-- Step 3: Health (same as index.html) -->
            <div class="form-step" data-step="3">
                <h2 class="step-title" data-translate="steps.health">Sant&eacute;</h2>

                <div class="form-group">
                    <label for="weight" data-translate="health.weight">Poids (kg) *</label>
                    <input type="number" id="weight" name="weight" min="2" max="400" step="0.5" required>
                    <span class="hint" data-translate="health.weight_hint">Pour les enfants, indiquez le poids actuel</span>
                    <span class="field-hint" data-translate="hints.weight_range">Entre 2 et 400 kg</span>
                    <span class="error-message"></span>
                </div>

                <!-- Reproductive Health (conditional) -->
                <div id="reproductive-section" class="conditional-section">
                    <div class="section-title" data-translate="health.reproductive_title">Sant&eacute; reproductive</div>

                    <div id="show-reproductive-question" class="form-group hidden">
                        <label data-translate="health.show_reproductive">Souhaitez-vous r&eacute;pondre aux questions sur la sant&eacute; reproductive ?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="show_reproductive" value="oui" onchange="toggleReproductiveQuestions()">
                                <span data-translate="buttons.yes">Oui</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="show_reproductive" value="non" onchange="toggleReproductiveQuestions()">
                                <span data-translate="buttons.no">Non</span>
                            </label>
                        </div>
                    </div>

                    <div id="reproductive-questions">
                        <div class="form-group">
                            <label data-translate="health.pregnancy">&Ecirc;tes-vous enceinte ou envisagez-vous une grossesse dans les prochains mois ?</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="pregnancy" value="oui">
                                    <span data-translate="buttons.yes">Oui</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="pregnancy" value="non">
                                    <span data-translate="buttons.no">Non</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="pregnancy" value="na">
                                    <span data-translate="buttons.not_applicable">Non applicable</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label data-translate="health.contraception">Utilisez-vous une contraception ?</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="contraception" value="oui">
                                    <span data-translate="buttons.yes">Oui</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="contraception" value="non">
                                    <span data-translate="buttons.no">Non</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="contraception" value="na">
                                    <span data-translate="buttons.not_applicable">Non applicable</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label data-translate="health.breastfeeding">Allaitez-vous actuellement ?</label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="breastfeeding" value="oui">
                                    <span data-translate="buttons.yes">Oui</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="breastfeeding" value="non">
                                    <span data-translate="buttons.no">Non</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="last_menses" data-translate="health.last_menses">Derni&egrave;res r&egrave;gles</label>
                            <input type="date" id="last_menses" name="last_menses">
                            <span class="field-hint" data-translate="hints.date_past_only">Date dans le pass&eacute; uniquement</span>
                            <span class="optional-badge" data-translate="buttons.optional">Facultatif</span>
                            <span class="error-message"></span>
                        </div>
                    </div>
                </div>

                <!-- Allergies -->
                <div class="section-title" data-translate="health.allergies_title">Allergies</div>
                <div class="form-group">
                    <label data-translate="health.allergy_question">Avez-vous des allergies ? *</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="oeufs" onchange="handleAllergyChange()">
                            <span data-translate="health.allergy_eggs">&#338;ufs</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="medicaments" onchange="handleAllergyChange()">
                            <span data-translate="health.allergy_medication">M&eacute;dicaments</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="aliments" onchange="handleAllergyChange()">
                            <span data-translate="health.allergy_food">Aliments</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="environnement" onchange="handleAllergyChange()">
                            <span data-translate="health.allergy_environment">Environnement</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="autre" onchange="handleAllergyChange()">
                            <span data-translate="health.allergy_other">Autre</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="allergy_types" value="aucune" onchange="handleAllergyChange(true)">
                            <span data-translate="health.allergy_none">Aucune allergie</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <div id="allergy-detail-oeufs" class="form-group conditional-section hidden">
                    <label data-translate="health.allergy_eggs_details">Pr&eacute;cisez votre allergie aux &oelig;ufs *</label>
                    <textarea name="allergy_detail_oeufs" rows="2" maxlength="500" placeholder="Ex: r&eacute;action cutan&eacute;e, choc anaphylactique..." data-placeholder="health.allergy_eggs_placeholder"></textarea>
                    <span class="error-message"></span>
                </div>
                <div id="allergy-detail-medicaments" class="form-group conditional-section hidden">
                    <label data-translate="health.allergy_medication_details">Pr&eacute;cisez votre allergie aux m&eacute;dicaments *</label>
                    <textarea name="allergy_detail_medicaments" rows="2" maxlength="500" placeholder="Ex: P&eacute;nicilline - urticaire..." data-placeholder="health.allergy_medication_placeholder"></textarea>
                    <span class="error-message"></span>
                </div>
                <div id="allergy-detail-aliments" class="form-group conditional-section hidden">
                    <label data-translate="health.allergy_food_details">Pr&eacute;cisez votre allergie alimentaire *</label>
                    <textarea name="allergy_detail_aliments" rows="2" maxlength="500" placeholder="Ex: fruits de mer, arachides..." data-placeholder="health.allergy_food_placeholder"></textarea>
                    <span class="error-message"></span>
                </div>
                <div id="allergy-detail-environnement" class="form-group conditional-section hidden">
                    <label data-translate="health.allergy_environment_details">Pr&eacute;cisez votre allergie environnementale *</label>
                    <textarea name="allergy_detail_environnement" rows="2" maxlength="500" placeholder="Ex: pollen, acariens, animaux..." data-placeholder="health.allergy_environment_placeholder"></textarea>
                    <span class="error-message"></span>
                </div>
                <div id="allergy-detail-autre" class="form-group conditional-section hidden">
                    <label data-translate="health.allergy_other_details">Pr&eacute;cisez votre autre allergie *</label>
                    <textarea name="allergy_detail_autre" rows="2" maxlength="500" placeholder="D&eacute;crivez votre allergie et la r&eacute;action..." data-placeholder="health.allergy_other_placeholder"></textarea>
                    <span class="error-message"></span>
                </div>

                <!-- Specific Diseases -->
                <div class="section-title" data-translate="health.diseases_title">Maladies sp&eacute;cifiques</div>
                <div class="form-group">
                    <label data-translate="health.dengue">Avez-vous eu la dengue ? *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="dengue_history" value="oui" required>
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="dengue_history" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="dengue_history" value="ne_sais_pas">
                            <span data-translate="buttons.dont_know">Je ne sais pas</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="health.chickenpox_disease">Avez-vous eu la varicelle ? *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_disease" value="oui" required>
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_disease" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_disease" value="ne_sais_pas">
                            <span data-translate="buttons.dont_know">Je ne sais pas</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label data-translate="health.chickenpox_vaccine">Avez-vous &eacute;t&eacute; vaccin&eacute;(e) contre la varicelle ? *</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_vaccine" value="oui" required>
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_vaccine" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="chickenpox_vaccine" value="ne_sais_pas">
                            <span data-translate="buttons.dont_know">Je ne sais pas</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <!-- Vaccination History -->
                <div class="section-title" data-translate="health.vaccination_history_title">Vaccinations ant&eacute;rieures</div>
                <div class="form-group">
                    <label data-translate="health.vaccination_problem">Avez-vous d&eacute;j&agrave; eu un effet ind&eacute;sirable grave apr&egrave;s un vaccin ? *</label>
                    <span class="hint" data-translate="health.vaccination_problem_hint">Ex: fi&egrave;vre &eacute;lev&eacute;e, gonflement important, r&eacute;action allergique s&eacute;v&egrave;re...</span>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="vaccination_problem" value="oui" required onchange="toggleVaccinationProblem()">
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="vaccination_problem" value="non" onchange="toggleVaccinationProblem()">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>
                <div id="vaccination-problem-details" class="form-group hidden">
                    <label for="vaccination_problem_details" data-translate="health.vaccination_problem_details">D&eacute;tails *</label>
                    <textarea id="vaccination_problem_details" name="vaccination_problem_details" rows="2" maxlength="500"></textarea>
                    <span class="error-message"></span>
                </div>

                <!-- Comorbidities -->
                <div class="section-title" data-translate="health.comorbidities_title">Maladies chroniques</div>
                <div class="form-group">
                    <label data-translate="health.comorbidities">Avez-vous ou avez-vous eu l'une des maladies suivantes ? *</label>
                    <div class="checkbox-group comorbidities-grouped">
                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_immune">Syst&egrave;me immunitaire</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="vih" onchange="toggleHivField(this); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_hiv">VIH</span>
                            </label>
                            <div id="hiv-cd4-field" class="inline-field hidden">
                                <label for="hiv_cd4" data-translate="health.hiv_cd4">Dernier CD4:</label>
                                <input type="number" id="hiv_cd4" name="hiv_cd4" min="0" max="5000" style="width: 100px;">
                                <label for="hiv_cd4_date" data-translate="health.hiv_cd4_date">Date:</label>
                                <input type="date" id="hiv_cd4_date" name="hiv_cd4_date">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="thymus" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_thymus">Probl&egrave;me du thymus</span>
                            </label>
                            <div id="comorbidity-detail-thymus" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_thymus" maxlength="200" data-placeholder="health.comorbidity_thymus_placeholder" placeholder="Thymome, ablation, syndrome de DiGeorge...">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="rate" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_spleen">Absence de rate</span>
                            </label>
                            <div id="comorbidity-detail-rate" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_rate" maxlength="200" data-placeholder="health.comorbidity_spleen_placeholder" placeholder="Spl&eacute;nectomie, cong&eacute;nitale...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_cancer">Cancers et maladies du sang</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="cancer" onchange="toggleChemoQuestion(); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_cancer">Cancer</span>
                            </label>
                            <div id="comorbidity-detail-cancer" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_cancer" maxlength="200" data-placeholder="health.comorbidity_cancer_placeholder" placeholder="Type de cancer, date du diagnostic...">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="hematologie" onchange="toggleChemoQuestion(); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_hematologic">Maladie h&eacute;matologique</span>
                            </label>
                            <div id="comorbidity-detail-hematologie" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_hematologie" maxlength="200" data-placeholder="health.comorbidity_hematologic_placeholder" placeholder="Leuc&eacute;mie, lymphome, an&eacute;mie falciforme...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_cardio">Cardiovasculaire</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="hypertension">
                                <span data-translate="health.comorbidity_hypertension">Hypertension</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="cardiaque" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_heart">Maladie cardiaque</span>
                            </label>
                            <div id="comorbidity-detail-cardiaque" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_cardiaque" maxlength="200" data-placeholder="health.comorbidity_heart_placeholder" placeholder="Insuffisance cardiaque, arythmie, valvulopathie...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_metabolic">M&eacute;tabolique</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="diabete" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_diabetes">Diab&egrave;te</span>
                            </label>
                            <div id="comorbidity-detail-diabete" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_diabete" maxlength="200" data-placeholder="health.comorbidity_diabetes_placeholder" placeholder="Type 1, type 2, gestationnel...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_respiratory">Respiratoire</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="asthme">
                                <span data-translate="health.comorbidity_asthma">Asthme</span>
                            </label>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_digestive">Digestif</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="inflammatoire" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_inflammatory">Maladie inflammatoire intestinale</span>
                            </label>
                            <div id="comorbidity-detail-inflammatoire" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_inflammatoire" maxlength="200" data-placeholder="health.comorbidity_inflammatory_placeholder" placeholder="Crohn, RCH...">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="digestive" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_digestive">Maladie digestive chronique</span>
                            </label>
                            <div id="comorbidity-detail-digestive" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_digestive" maxlength="200" data-placeholder="health.comorbidity_digestive_placeholder" placeholder="Gastrite, reflux, h&eacute;patite...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_rheumatic">Rhumatologique</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="rhumatologie" onchange="toggleChemoQuestion(); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_rheumatic">Maladie rhumatologique</span>
                            </label>
                            <div id="comorbidity-detail-rhumatologie" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_rhumatologie" maxlength="200" data-placeholder="health.comorbidity_rheumatic_placeholder" placeholder="Polyarthrite, lupus, spondylarthrite...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_neuro">Neurologique</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="epilepsie">
                                <span data-translate="health.comorbidity_epilepsy">&Eacute;pilepsie</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="musculaire" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_muscular">Maladie musculaire</span>
                            </label>
                            <div id="comorbidity-detail-musculaire" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_musculaire" maxlength="200" data-placeholder="health.comorbidity_muscular_placeholder" placeholder="Myasth&eacute;nie, dystrophie...">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_mental">Sant&eacute; mentale</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="psychiatrique" onchange="togglePsychiatricField(this); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_psychiatric">Maladie psychiatrique</span>
                            </label>
                            <div id="psychiatric-details-field" class="inline-field hidden">
                                <label for="psychiatric_details" data-translate="health.psychiatric_details">D&eacute;tails:</label>
                                <input type="text" id="psychiatric_details" name="psychiatric_details" maxlength="200">
                            </div>
                        </div>

                        <div class="comorbidity-group">
                            <div class="group-title" data-translate="health.comorbidity_group_other">Autres</div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="chirurgie" onchange="toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_surgery">Chirurgie/immobilisation r&eacute;cente (&lt; 6 semaines)</span>
                            </label>
                            <div id="comorbidity-detail-chirurgie" class="inline-field hidden">
                                <input type="text" name="comorbidity_detail_chirurgie" maxlength="200" data-placeholder="health.comorbidity_surgery_placeholder" placeholder="Type d'intervention, date...">
                            </div>
                            <label class="checkbox-label">
                                <input type="checkbox" name="comorbidities" value="autre" onchange="toggleOtherComorbidity(this); toggleComorbidityDetail(this)">
                                <span data-translate="health.comorbidity_other">Autre</span>
                            </label>
                            <div id="comorbidity-other-field" class="inline-field hidden">
                                <label for="comorbidity_other" data-translate="health.comorbidity_other_details">D&eacute;tails:</label>
                                <input type="text" id="comorbidity_other" name="comorbidity_other" maxlength="200">
                            </div>
                        </div>

                        <label class="checkbox-label standalone">
                            <input type="checkbox" name="comorbidities" value="aucune" onchange="toggleNoneComorbidity(this)">
                            <span data-translate="health.comorbidity_none">Aucune maladie chronique</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <!-- Chemotherapy question (conditional) -->
                <div id="chemotherapy-question" class="form-group hidden">
                    <label data-translate="health.recent_chemotherapy">Avez-vous re&ccedil;u un traitement contre le cancer ou un traitement immunosuppresseur dans les 6 derniers mois ? *</label>
                    <span class="hint" data-translate="health.recent_chemotherapy_hint">Chimioth&eacute;rapie, radioth&eacute;rapie, immunomodulateurs...</span>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="recent_chemotherapy" value="oui">
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="recent_chemotherapy" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>

                <!-- Medications -->
                <div class="section-title" data-translate="health.medications_title">M&eacute;dicaments</div>
                <div class="form-group">
                    <label data-translate="health.takes_medication">Prenez-vous des m&eacute;dicaments ? *</label>
                    <span class="hint" data-translate="health.takes_medication_hint">Y compris pilule contraceptive, compl&eacute;ments alimentaires et traitements r&eacute;guliers</span>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="takes_medication" value="oui" required onchange="toggleMedicationField()">
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="takes_medication" value="non" onchange="toggleMedicationField()">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                    </div>
                    <span class="error-message"></span>
                </div>
                <div id="medication-details" class="form-group hidden">
                    <label for="medication_list" data-translate="health.medication_list">Liste des m&eacute;dicaments *</label>
                    <textarea id="medication_list" name="medication_list" rows="3" maxlength="1000"></textarea>
                    <span class="error-message"></span>
                </div>
            </div>

            <!-- Step 4: Vaccination -->
            <div class="form-step" data-step="4">
                <h2 class="step-title" data-translate="steps.vaccination">Carnet de vaccination</h2>
                <p class="step-subtitle" data-translate="vaccination.subtitle">Importez votre carnet de vaccination (PDF ou photos)</p>

                <div class="form-group">
                    <div class="file-dropzone" id="file-dropzone">
                        <div class="dropzone-icon">&#128206;</div>
                        <div class="dropzone-text" data-translate="vaccination.dropzone_text">Glissez vos fichiers ici ou cliquez pour importer</div>
                        <div class="dropzone-formats" data-translate="vaccination.dropzone_formats">Formats: PDF, JPG, PNG, HEIC</div>
                        <div class="dropzone-limit" data-translate="vaccination.dropzone_limit">Maximum: 10 fichiers, 10 MB chacun</div>
                        <input type="file" id="vaccination_files" name="vaccination_files" multiple
                               accept=".pdf,.jpg,.jpeg,.png,.heic,.heif" class="file-input">
                    </div>
                    <div class="file-list" id="file-list"></div>
                    <span class="error-message"></span>
                </div>

                <div class="form-group">
                    <label class="checkbox-label standalone">
                        <input type="checkbox" name="no_vaccination_card" id="no_vaccination_card" onchange="toggleNoVaccinationCard()">
                        <span data-translate="vaccination.no_card">Je n'ai pas de carnet de vaccination</span>
                    </label>
                </div>
            </div>

            <!-- Step 5: Referral -->
            <div class="form-step" data-step="5">
                <h2 class="step-title" data-translate="referral.title">Comment nous avez-vous trouv&eacute; ?</h2>
                <p class="step-subtitle" data-translate="referral.subtitle">Vos r&eacute;ponses nous aident &agrave; am&eacute;liorer nos services</p>

                <div class="form-group">
                    <label data-translate="referral.returning_question">Avez-vous d&eacute;j&agrave; consult&eacute; chez Travel Doctor ?</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="returning_patient" value="oui">
                            <span data-translate="buttons.yes">Oui</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="returning_patient" value="non">
                            <span data-translate="buttons.no">Non</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label data-translate="referral.source">Comment avez-vous entendu parler de nous ?</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="internet">
                            <span data-translate="referral.source_internet">Recherche Internet</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="social_media">
                            <span data-translate="referral.source_social">R&eacute;seaux sociaux</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="doctor" onchange="toggleReferralDetail(this, 'referral-doctor-detail')">
                            <span data-translate="referral.source_doctor">M&eacute;decin/professionnel de sant&eacute;</span>
                        </label>
                        <div id="referral-doctor-detail" class="inline-field hidden">
                            <input type="text" name="referral_doctor_name" maxlength="200" data-placeholder="referral.doctor_name_placeholder" placeholder="Nom du m&eacute;decin ou du cabinet...">
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="friend" onchange="toggleReferralDetail(this, 'referral-friend-detail')">
                            <span data-translate="referral.source_friend">Ami/famille</span>
                        </label>
                        <div id="referral-friend-detail" class="inline-field hidden">
                            <input type="text" name="referral_friend_name" maxlength="200" data-placeholder="referral.friend_name_placeholder" placeholder="Nom de la personne (facultatif)">
                        </div>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="pharmacy">
                            <span data-translate="referral.source_pharmacy">Pharmacie</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="travel_agency">
                            <span data-translate="referral.source_travel_agency">Agence de voyage</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="referral_source" value="other" onchange="toggleReferralDetail(this, 'referral-other-detail')">
                            <span data-translate="referral.source_other">Autre</span>
                        </label>
                        <div id="referral-other-detail" class="inline-field hidden">
                            <input type="text" name="referral_other_specify" maxlength="200" data-placeholder="referral.other_specify" placeholder="Pr&eacute;cisez...">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label data-translate="referral.choice_factor">Qu'est-ce qui a motiv&eacute; votre choix ?</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="location">
                            <span data-translate="referral.factor_location">Emplacement</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="price">
                            <span data-translate="referral.factor_price">Prix</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="reputation">
                            <span data-translate="referral.factor_reputation">R&eacute;putation</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="recommendation">
                            <span data-translate="referral.factor_recommendation">Recommandation</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="expertise">
                            <span data-translate="referral.factor_expertise">Expertise</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="availability">
                            <span data-translate="referral.factor_availability">Disponibilit&eacute;</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" name="choice_factor" value="languages">
                            <span data-translate="referral.factor_languages">Langues parl&eacute;es</span>
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="comment" data-translate="referral.comment">Commentaire</label>
                    <textarea id="comment" name="comment" rows="3" maxlength="1000" data-placeholder="referral.comment_placeholder" placeholder="Remarques ou informations compl&eacute;mentaires..."></textarea>
                    <span class="optional-badge" data-translate="buttons.optional">Facultatif</span>
                </div>
            </div>

            <!-- Step 6: Summary -->
            <div class="form-step" data-step="6">
                <h2 class="step-title" data-translate="steps.summary">R&eacute;capitulatif</h2>
                <p class="step-subtitle" data-translate="summary.subtitle">V&eacute;rifiez vos informations avant envoi</p>

                <div class="summary-container">
                    <div class="summary-section">
                        <div class="summary-header">
                            <h3 data-translate="steps.identity">Identit&eacute;</h3>
                            <button type="button" class="btn-edit" onclick="goToStep(1)" data-translate="buttons.edit">Modifier</button>
                        </div>
                        <div class="summary-content" id="summary-identity"></div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-header">
                            <h3 data-translate="steps.travel">Voyage</h3>
                            <button type="button" class="btn-edit" onclick="goToStep(2)" data-translate="buttons.edit">Modifier</button>
                        </div>
                        <div class="summary-content" id="summary-travel"></div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-header">
                            <h3 data-translate="steps.health">Sant&eacute;</h3>
                            <button type="button" class="btn-edit" onclick="goToStep(3)" data-translate="buttons.edit">Modifier</button>
                        </div>
                        <div class="summary-content" id="summary-health"></div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-header">
                            <h3 data-translate="steps.vaccination">Carnet de vaccination</h3>
                            <button type="button" class="btn-edit" onclick="goToStep(4)" data-translate="buttons.edit">Modifier</button>
                        </div>
                        <div class="summary-content" id="summary-vaccination"></div>
                    </div>

                    <div class="summary-section">
                        <div class="summary-header">
                            <h3 data-translate="steps.referral">Recommandation</h3>
                            <button type="button" class="btn-edit" onclick="goToStep(5)" data-translate="buttons.edit">Modifier</button>
                        </div>
                        <div class="summary-content" id="summary-referral"></div>
                    </div>
                </div>

                <!-- hCaptcha -->
                <div class="captcha-container">
                    <div class="h-captcha" data-sitekey="9706b8ca-59c8-461c-b600-780c525cd7a2"></div>
                </div>

                <!-- Consent -->
                <div class="form-group consent-group">
                    <label class="checkbox-label consent-checkbox">
                        <input type="checkbox" name="consent" id="consent" required>
                        <span data-translate="summary.consent">Je d&eacute;clare avoir r&eacute;pondu &agrave; ce questionnaire de mani&egrave;re honn&ecirc;te et sinc&egrave;re. Je reconnais que ces informations seront utilis&eacute;es pour &eacute;valuer mon &eacute;tat de sant&eacute;.</span>
                    </label>
                    <span class="error-message"></span>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="form-navigation">
                <button type="button" class="btn btn-secondary" id="btn-previous" onclick="previousStep()" style="display:none;">
                    <span data-translate="buttons.previous">&larr; Pr&eacute;c&eacute;dent</span>
                </button>
                <button type="button" class="btn btn-primary" id="btn-next" onclick="nextStep()">
                    <span data-translate="buttons.next">Suivant &rarr;</span>
                </button>
                <button type="submit" class="btn btn-success" id="btn-submit" style="display:none;">
                    <span data-translate="buttons.submit">&#10003; Confirmer et envoyer</span>
                </button>
            </div>
        </form>

        <!-- Footer -->
        <footer class="form-footer">
            <p>En cas de probl&egrave;me technique, <a href="https://www.traveldoctor.ch/whatsapp" target="_blank">contactez-nous via WhatsApp</a></p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="js/translations.js"></script>
    <script src="js/countries.js"></script>
    <script src="js/form.js"></script>
    <script>
        // Track if we're editing an existing submitted form
        let isEditingSubmittedForm = false;
        let editFormToken = null;

        // Override loadDraft to detect submitted forms
        const originalLoadDraft = loadDraft;
        async function loadDraft(editToken) {
            try {
                const response = await fetch(API_URL + '/get-draft.php?token=' + editToken);
                const data = await response.json();

                if (data.success && data.form_data) {
                    currentToken = editToken;

                    // Check if this is a submitted form (not just a draft)
                    if (data.is_submitted) {
                        isEditingSubmittedForm = true;
                        editFormToken = editToken;
                    }

                    populateForm(data.form_data);

                    if (data.step_reached) {
                        goToStep(data.step_reached);
                    }

                    if (data.language) {
                        setLanguage(data.language);
                    }

                    // Clear token from URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            } catch (error) {
                console.error('Draft load error:', error);
            }
        }

        // Override submit for public form with hCaptcha
        const originalSubmitForm = submitForm;

        async function submitForm() {
            // Validate captcha first (only for new submissions)
            const captchaResponse = document.querySelector('[name="h-captcha-response"]')?.value;

            if (!isEditingSubmittedForm && !captchaResponse) {
                alert(t('errors.captcha_required') || 'Veuillez complter le CAPTCHA');
                return;
            }

            if (!validateCurrentStep()) return;

            const btnSubmit = document.getElementById('btn-submit');
            btnSubmit.disabled = true;
            btnSubmit.innerHTML = '<span class="spinner"></span> ' + t('messages.submitting');

            try {
                // Upload files if any
                let fileIds = [];
                if (uploadedFiles.length > 0) {
                    fileIds = await uploadFiles();
                }

                // Collect form data
                const formData = collectFormData();
                formData.vaccination_file_ids = fileIds;
                formData.language = currentLang;

                let response;

                if (isEditingSubmittedForm && editFormToken) {
                    // Update existing form
                    response = await fetch('/api/update-form.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            edit_token: editFormToken,
                            form_data: formData
                        })
                    });
                } else {
                    // New submission with captcha
                    response = await fetch('/api/submit-public.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            captcha_token: captchaResponse,
                            form_data: formData
                        })
                    });
                }

                const data = await response.json();

                if (data.success) {
                    showSuccessScreen(formData.email);
                } else {
                    alert(data.error || t('errors.submission_failed'));
                    btnSubmit.disabled = false;
                    btnSubmit.innerHTML = '<span>' + t('buttons.submit') + '</span>';
                    if (window.hcaptcha && !isEditingSubmittedForm) {
                        hcaptcha.reset();
                    }
                }
            } catch (error) {
                console.error('Submission error:', error);
                alert(t('errors.connection_error'));
                btnSubmit.disabled = false;
                btnSubmit.innerHTML = '<span>' + t('buttons.submit') + '</span>';
                if (window.hcaptcha && !isEditingSubmittedForm) {
                    hcaptcha.reset();
                }
            }
        }
    </script>
</body>
</html>
